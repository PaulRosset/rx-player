{"id":"../../../core/eme/check_key_statuses.ts","dependencies":[{"name":"/home/prosset/Documents/Canal+/rx-player/tsconfig.json","includedInParent":true,"mtime":1567699906905},{"name":"/home/prosset/Documents/Canal+/rx-player/package.json","includedInParent":true,"mtime":1571390912278},{"name":"../../errors","loc":{"line":18,"column":25},"parent":"/home/prosset/Documents/Canal+/rx-player/src/core/eme/check_key_statuses.ts","resolved":"/home/prosset/Documents/Canal+/rx-player/src/errors/index.ts"}],"generated":{"js":"\"use strict\";\n/**\n * Copyright 2015 CANAL+ Group\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar errors_1 = require(\"../../errors\");\n\nvar KEY_STATUSES = {\n  EXPIRED: \"expired\",\n  INTERNAL_ERROR: \"internal-error\",\n  OUTPUT_RESTRICTED: \"output-restricted\"\n};\n/**\n * Look at the current key statuses in the sessions and construct the\n * appropriate warnings\n *\n * Throws if one of the keyID is on an error.\n * @param {MediaKeySession} session - The MediaKeySession from which the keys\n * will be checked.\n * @param {Object} keySystem - Configuration. Used to known on which situations\n * we can fallback.\n * @returns {Array} - Warnings to send.\n */\n\nfunction checkKeyStatuses(session, keySystem) {\n  var warnings = [];\n  session.keyStatuses.forEach(function (_arg1, _arg2) {\n    // Hack present because the order of the arguments has changed in spec\n    // and is not the same between some versions of Edge and Chrome.\n    var keyStatus = function () {\n      return typeof _arg1 === \"string\" ? _arg1 : _arg2;\n    }();\n\n    switch (keyStatus) {\n      case KEY_STATUSES.EXPIRED:\n        {\n          var error = new errors_1.EncryptedMediaError(\"KEY_STATUS_CHANGE_ERROR\", \"A decryption key expired\");\n\n          if (keySystem.throwOnLicenseExpiration !== false) {\n            throw error;\n          }\n\n          warnings.push({\n            type: \"warning\",\n            value: error\n          });\n          break;\n        }\n\n      case KEY_STATUSES.OUTPUT_RESTRICTED:\n      case KEY_STATUSES.INTERNAL_ERROR:\n        throw new errors_1.EncryptedMediaError(\"KEY_STATUS_CHANGE_ERROR\", \"An invalid key status has been \" + \"encountered: \" + keyStatus);\n    }\n  });\n  return warnings;\n}\n\nexports.default = checkKeyStatuses;"},"sourceMaps":{"js":{"mappings":[{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":1,"column":0},"generated":{"line":2,"column":0}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":18,"column":0},"generated":{"line":22,"column":0}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":18,"column":0},"generated":{"line":22,"column":4}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":18,"column":0},"generated":{"line":22,"column":12}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":18,"column":0},"generated":{"line":22,"column":15}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":18,"column":0},"generated":{"line":22,"column":22}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":18,"column":0},"generated":{"line":22,"column":23}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":18,"column":0},"generated":{"line":22,"column":37}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":18,"column":0},"generated":{"line":22,"column":38}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":24,"column":0},"generated":{"line":24,"column":0}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":24,"column":6},"generated":{"line":24,"column":4}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":24,"column":18},"generated":{"line":24,"column":16}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":24,"column":21},"generated":{"line":24,"column":19}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":24,"column":23},"generated":{"line":25,"column":0}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":24,"column":23},"generated":{"line":25,"column":2}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":24,"column":30},"generated":{"line":25,"column":9}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":24,"column":32},"generated":{"line":25,"column":11}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":24,"column":21},"generated":{"line":25,"column":20}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":25,"column":23},"generated":{"line":26,"column":0}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":25,"column":23},"generated":{"line":26,"column":2}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":25,"column":37},"generated":{"line":26,"column":16}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":25,"column":39},"generated":{"line":26,"column":18}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":24,"column":21},"generated":{"line":26,"column":34}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":26,"column":23},"generated":{"line":27,"column":0}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":26,"column":23},"generated":{"line":27,"column":2}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":26,"column":40},"generated":{"line":27,"column":19}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":26,"column":42},"generated":{"line":27,"column":21}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":24,"column":21},"generated":{"line":28,"column":0}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":24,"column":0},"generated":{"line":28,"column":1}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":28,"column":0},"generated":{"line":29,"column":0}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":39,"column":0},"generated":{"line":41,"column":0}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":39,"column":24},"generated":{"line":41,"column":9}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":39,"column":0},"generated":{"line":41,"column":25}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":40,"column":2},"generated":{"line":41,"column":26}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":39,"column":0},"generated":{"line":41,"column":33}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":41,"column":2},"generated":{"line":41,"column":35}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":39,"column":0},"generated":{"line":41,"column":44}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":41,"column":29},"generated":{"line":41,"column":46}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":43,"column":2},"generated":{"line":42,"column":0}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":43,"column":8},"generated":{"line":42,"column":6}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":43,"column":16},"generated":{"line":42,"column":14}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":43,"column":40},"generated":{"line":42,"column":17}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":43,"column":2},"generated":{"line":42,"column":19}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":45,"column":3},"generated":{"line":43,"column":0}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":45,"column":3},"generated":{"line":43,"column":2}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":45,"column":10},"generated":{"line":43,"column":9}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":45,"column":11},"generated":{"line":43,"column":10}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":45,"column":3},"generated":{"line":43,"column":21}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":45,"column":31},"generated":{"line":43,"column":22}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":45,"column":3},"generated":{"line":43,"column":29}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":45,"column":39},"generated":{"line":43,"column":30}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":45,"column":40},"generated":{"line":43,"column":40}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":45,"column":39},"generated":{"line":43,"column":45}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":45,"column":57},"generated":{"line":43,"column":47}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":45,"column":39},"generated":{"line":43,"column":52}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":45,"column":76},"generated":{"line":43,"column":54}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":46,"column":4},"generated":{"line":44,"column":0}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":47,"column":4},"generated":{"line":45,"column":0}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":48,"column":4},"generated":{"line":46,"column":0}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":48,"column":10},"generated":{"line":46,"column":8}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":48,"column":19},"generated":{"line":46,"column":17}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":48,"column":23},"generated":{"line":46,"column":20}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":48,"column":28},"generated":{"line":46,"column":32}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":49,"column":6},"generated":{"line":47,"column":0}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":49,"column":14},"generated":{"line":47,"column":13}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":49,"column":21},"generated":{"line":47,"column":20}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":49,"column":14},"generated":{"line":47,"column":25}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":49,"column":32},"generated":{"line":47,"column":30}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":49,"column":14},"generated":{"line":47,"column":38}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":49,"column":43},"generated":{"line":47,"column":41}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":49,"column":14},"generated":{"line":47,"column":46}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":50,"column":43},"generated":{"line":47,"column":49}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":49,"column":6},"generated":{"line":47,"column":54}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":52,"column":5},"generated":{"line":48,"column":0}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":48,"column":22},"generated":{"line":48,"column":5}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":48,"column":4},"generated":{"line":48,"column":7}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":54,"column":4},"generated":{"line":50,"column":0}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":54,"column":12},"generated":{"line":50,"column":12}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":54,"column":4},"generated":{"line":50,"column":21}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":55,"column":6},"generated":{"line":51,"column":0}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":55,"column":11},"generated":{"line":51,"column":11}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":55,"column":23},"generated":{"line":51,"column":23}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":55,"column":24},"generated":{"line":51,"column":24}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":55,"column":6},"generated":{"line":51,"column":31}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":55,"column":33},"generated":{"line":52,"column":0}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":56,"column":8},"generated":{"line":53,"column":0}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":56,"column":14},"generated":{"line":53,"column":14}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":56,"column":19},"generated":{"line":53,"column":19}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":56,"column":22},"generated":{"line":53,"column":22}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":56,"column":26},"generated":{"line":53,"column":26}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":56,"column":26},"generated":{"line":53,"column":34}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":56,"column":26},"generated":{"line":53,"column":35}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":56,"column":22},"generated":{"line":53,"column":54}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":56,"column":46},"generated":{"line":53,"column":55}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":56,"column":22},"generated":{"line":53,"column":80}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":57,"column":46},"generated":{"line":53,"column":82}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":56,"column":22},"generated":{"line":53,"column":108}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":56,"column":8},"generated":{"line":53,"column":109}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":59,"column":8},"generated":{"line":55,"column":0}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":59,"column":12},"generated":{"line":55,"column":14}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":59,"column":21},"generated":{"line":55,"column":23}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":59,"column":22},"generated":{"line":55,"column":24}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":59,"column":12},"generated":{"line":55,"column":48}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":59,"column":51},"generated":{"line":55,"column":53}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":59,"column":8},"generated":{"line":55,"column":58}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":59,"column":58},"generated":{"line":55,"column":60}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":60,"column":10},"generated":{"line":56,"column":0}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":60,"column":16},"generated":{"line":56,"column":18}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":60,"column":10},"generated":{"line":56,"column":23}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":61,"column":9},"generated":{"line":57,"column":0}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":62,"column":8},"generated":{"line":59,"column":0}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":62,"column":8},"generated":{"line":59,"column":10}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":62,"column":16},"generated":{"line":59,"column":18}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":62,"column":17},"generated":{"line":59,"column":19}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":62,"column":8},"generated":{"line":59,"column":23}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":62,"column":22},"generated":{"line":59,"column":24}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":62,"column":24},"generated":{"line":60,"column":0}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":62,"column":24},"generated":{"line":60,"column":12}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":62,"column":28},"generated":{"line":60,"column":16}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":62,"column":30},"generated":{"line":60,"column":18}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":62,"column":22},"generated":{"line":60,"column":27}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":62,"column":41},"generated":{"line":61,"column":0}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":62,"column":41},"generated":{"line":61,"column":12}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":62,"column":46},"generated":{"line":61,"column":17}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":62,"column":48},"generated":{"line":61,"column":19}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":62,"column":22},"generated":{"line":62,"column":0}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":62,"column":8},"generated":{"line":62,"column":11}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":63,"column":8},"generated":{"line":63,"column":0}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":64,"column":7},"generated":{"line":64,"column":0}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":66,"column":6},"generated":{"line":66,"column":0}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":66,"column":11},"generated":{"line":66,"column":11}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":66,"column":23},"generated":{"line":66,"column":23}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":66,"column":24},"generated":{"line":66,"column":24}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":66,"column":6},"generated":{"line":66,"column":41}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":67,"column":6},"generated":{"line":67,"column":0}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":67,"column":11},"generated":{"line":67,"column":11}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":67,"column":23},"generated":{"line":67,"column":23}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":67,"column":24},"generated":{"line":67,"column":24}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":67,"column":6},"generated":{"line":67,"column":38}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":68,"column":8},"generated":{"line":68,"column":0}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":68,"column":14},"generated":{"line":68,"column":14}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":68,"column":18},"generated":{"line":68,"column":18}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":68,"column":18},"generated":{"line":68,"column":26}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":68,"column":18},"generated":{"line":68,"column":27}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":68,"column":14},"generated":{"line":68,"column":46}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":68,"column":38},"generated":{"line":68,"column":47}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":68,"column":14},"generated":{"line":68,"column":72}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":69,"column":38},"generated":{"line":68,"column":74}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":70,"column":38},"generated":{"line":68,"column":110}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":69,"column":38},"generated":{"line":68,"column":125}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":70,"column":56},"generated":{"line":68,"column":128}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":68,"column":14},"generated":{"line":68,"column":137}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":68,"column":8},"generated":{"line":68,"column":138}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":54,"column":4},"generated":{"line":69,"column":0}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":72,"column":3},"generated":{"line":70,"column":0}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":45,"column":3},"generated":{"line":70,"column":3}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":73,"column":2},"generated":{"line":71,"column":0}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":73,"column":9},"generated":{"line":71,"column":9}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":73,"column":2},"generated":{"line":71,"column":17}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":74,"column":1},"generated":{"line":72,"column":0}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":39,"column":0},"generated":{"line":74,"column":0}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":39,"column":0},"generated":{"line":74,"column":7}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":39,"column":0},"generated":{"line":74,"column":8}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":39,"column":0},"generated":{"line":74,"column":15}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":39,"column":0},"generated":{"line":74,"column":18}},{"source":"../../../core/eme/check_key_statuses.ts","name":null,"original":{"line":39,"column":0},"generated":{"line":74,"column":34}}],"sources":{"../../../core/eme/check_key_statuses.ts":"/**\n * Copyright 2015 CANAL+ Group\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ICustomMediaKeySession } from \"../../compat\";\nimport { EncryptedMediaError } from \"../../errors\";\nimport {\n  IEMEWarningEvent,\n  IKeySystemOption,\n} from \"./types\";\n\nconst KEY_STATUSES = { EXPIRED: \"expired\",\n                       INTERNAL_ERROR: \"internal-error\",\n                       OUTPUT_RESTRICTED: \"output-restricted\" };\n\n/**\n * Look at the current key statuses in the sessions and construct the\n * appropriate warnings\n *\n * Throws if one of the keyID is on an error.\n * @param {MediaKeySession} session - The MediaKeySession from which the keys\n * will be checked.\n * @param {Object} keySystem - Configuration. Used to known on which situations\n * we can fallback.\n * @returns {Array} - Warnings to send.\n */\nexport default function checkKeyStatuses(\n  session : MediaKeySession | ICustomMediaKeySession,\n  keySystem: IKeySystemOption\n) : IEMEWarningEvent[] {\n  const warnings : IEMEWarningEvent[] = [];\n\n  (session.keyStatuses as any).forEach((_arg1 : unknown, _arg2 : unknown) => {\n    // Hack present because the order of the arguments has changed in spec\n    // and is not the same between some versions of Edge and Chrome.\n    const keyStatus = (() => {\n      return (typeof _arg1  === \"string\" ? _arg1 :\n                                           _arg2\n             ) as MediaKeyStatus;\n    })();\n\n    switch (keyStatus) {\n      case KEY_STATUSES.EXPIRED: {\n        const error = new EncryptedMediaError(\"KEY_STATUS_CHANGE_ERROR\",\n                                              \"A decryption key expired\");\n\n        if (keySystem.throwOnLicenseExpiration !== false) {\n          throw error;\n        }\n        warnings.push({ type: \"warning\", value: error });\n        break;\n      }\n\n      case KEY_STATUSES.OUTPUT_RESTRICTED:\n      case KEY_STATUSES.INTERNAL_ERROR:\n        throw new EncryptedMediaError(\"KEY_STATUS_CHANGE_ERROR\",\n                                      \"An invalid key status has been \" +\n                                      \"encountered: \" + keyStatus);\n    }\n  });\n  return warnings;\n}\n"},"lineCount":null}},"error":null,"hash":"7edf7823831222c5ec6a4f5af455987a","cacheData":{"env":{}}}