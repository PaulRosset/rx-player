var reTag = /^@\S+/;
export default function getParser(_a) {
    var _b = (_a === void 0 ? {} : _a).fence, fence = _b === void 0 ? '```' : _b;
    var fencer = getFencer(fence);
    var toggleFence = function (source, isFenced) {
        return fencer(source) ? !isFenced : isFenced;
    };
    return function parseBlock(source) {
        // start with description section
        var sections = [[]];
        var isFenced = false;
        for (var _i = 0, source_1 = source; _i < source_1.length; _i++) {
            var line = source_1[_i];
            if (reTag.test(line.tokens.description) && !isFenced) {
                sections.push([line]);
            }
            else {
                sections[sections.length - 1].push(line);
            }
            isFenced = toggleFence(line.tokens.description, isFenced);
        }
        return sections;
    };
}
function getFencer(fence) {
    if (typeof fence === 'string')
        return function (source) { return source.split(fence).length % 2 === 0; };
    return fence;
}
